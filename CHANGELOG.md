# ArcherDoc AI Changelog

## 2025-12-02

### 🌟 新增功能

#### 视频生成系统
- **新增视频生成功能**：将静态PPT转换为带有AI语音讲解的动态视频
- **AI讲稿生成**：自动为每张幻灯片生成专业的演讲文稿
- **语音合成**：支持多种语音音色，可自定义语速和停顿
- **单页视频生成**：为每张幻灯片生成独立视频，便于预览和修改
- **视频合并**：将所有单页视频合并为完整视频，支持多种分辨率和质量选项
- **实时预览**：生成过程中可实时预览视频效果

#### 组件新增
- **MagicTextDisplay.tsx**：动态文本展示组件，用于显示翻译和视频生成过程中的实时文本
- **VideoReviewModal.tsx**：视频审核模态框，用于审核和修改每张幻灯片的讲稿

#### 页面新增
- **VideoReviewPage.tsx**：视频审核页面，用于审核和修改每张幻灯片的讲稿，并生成视频

#### 目录结构新增
- **ppt2video/**：视频生成相关文件，包括n8n工作流配置和Python脚本

### 📝 修改功能

#### App.tsx
- 添加了视频生成功能的支持
- 修改了视频生成处理的动画文字显示时间，确保每个步骤至少显示1秒
- 优化了视频生成的进度显示和状态更新
- 实现了AI讲稿生成参数的用户配置

#### README.md
- 更新了项目介绍，强调了项目集翻译与视频生成于一体的功能
- 新增了智能视频生成系统的介绍
- 更新了技术架构，添加了后端服务、语音合成、视频处理等技术栈
- 新增了项目结构介绍

#### USER_GUIDE.md
- 扩展了项目简介，强调了项目的翻译和视频生成功能
- 新增了视频生成设置的配置说明
- 新增了生成视频的步骤说明
- 新增了视频审核与修改的步骤说明
- 新增了统一字体功能的说明
- 新增了常见问题排查，包括视频生成失败、语音生成失败等
- 新增了高级功能，包括本地模型配置、视频质量设置、语音设置等

#### SettingsModal.tsx
- 重构了设置模态框，采用标签页布局
- 新增了视频生成设置标签页
- 添加了MiniMax Group ID、Access Token、语音音色等配置项
- 优化了设置界面的布局和样式

#### constants.ts
- 新增了视频生成相关的常量，包括可用语音、视频质量选项、分辨率选项等
- 新增了默认视频设置
- 更新了默认设置，添加了视频设置配置
- 移除了未使用的视频质量、分辨率和合成方法常量

#### services/aiService.ts
- 新增了generateScript函数，用于生成视频脚本
- 优化了AI调用的重试机制
- 移除了未使用的generateScript函数

#### types.ts
- 新增了视频生成相关的类型定义，包括VideoSettings、SlideNote、SpeechVoice等
- 更新了AppSettings类型，添加了videoSettings字段
- 简化了VideoSettings接口，移除了videoQuality、videoResolution、videoFormat、synthesisMethod等未使用参数
- 新增了SpeechModelType枚举，支持MINIMAX和COQUI_TTS
- 新增了CoquiTTSSettings接口，用于配置Coqui TTS参数

### 🛠️ 技术改进

#### 架构调整
- 集成了n8n工作流引擎，用于处理视频生成的后端逻辑
- 集成了MiniMax语音API，用于生成AI语音
- 集成了FFmpeg，用于视频处理
- 新增了Coqui TTS支持，提供更多语音合成选项

#### 性能优化
- 优化了视频生成的进度显示
- 改进了动画文字的显示效果
- 优化了视频生成的状态管理
- 优化了音频生成脚本，移除了不必要的依赖（pydub/numpy）

#### 安全性改进
- 增强了API密钥的保护
- 优化了数据传输的安全性

#### 代码精简
- 移除了未使用的服务文件：pptRendererService.ts、speechService.ts、videoService.ts
- 简化了视频生成设置，移除了未使用的参数

### 🐛 修复问题
- 修复了视频生成过程中动画文字一闪而过的问题
- 修复了设置模态框的布局问题
- 修复了视频生成过程中的状态更新问题
- 修复了音频生成脚本的依赖问题
- 修复了AI讲稿生成参数配置问题
- 修复了uploadPPT.json工作流的JSON格式问题

### 🔧 脚本优化
- 1_generate_notes.py：支持用户配置的AI参数，不再使用硬编码的AI模型
- 3c_generate_single_audio.py：移除了pydub/numpy依赖，直接使用TTS库的tts_to_file方法
- 优化了错误处理，提高了脚本的健壮性

### 🔌 工作流更新
- uploadPPT.json：支持传递AI参数，实现AI讲稿生成的用户配置
- 优化了工作流的参数传递，确保AI参数正确传递到脚本

## 2025-12-03

### 🌟 新增功能

#### 文章生成系统
- **新增文章生成功能**：将PPT转换为公众号文章
- **AI文章生成**：基于PPT内容自动生成专业的公众号文章
- **文章设置**：支持配置文章类型、风格和自定义提示词
- **文章审核页面**：可以查看、编辑、重新生成和下载生成的文章
- **文章微调功能**：支持对生成的文章进行微调，输入具体的微调要求
- **Markdown支持**：生成的文章支持Markdown格式，并自动转换为HTML显示

#### 组件新增
- **ArticleSettingsModal.tsx**：文章生成设置模态框，用于配置文章生成参数
- **ArticleReviewPage.tsx**：文章审核页面，用于查看和编辑生成的文章

### 📝 修改功能

#### App.tsx
- 添加了文章生成功能的支持
- 新增了文章生成按钮和相关状态管理
- 实现了文章生成参数的用户配置
- 修改了页面标题和描述，添加了文章生成功能

#### constants.ts
- 新增了n8n配置常量，统一管理n8n地址
- 支持BASE_URL、API_PATH和WEBHOOK_PATH的配置

#### types.ts
- 新增了文章生成相关的类型定义，包括ArticleType、ArticleGenerationStats、ArticleResult等

#### 其他页面和组件
- 将所有硬编码的n8n地址替换为使用N8N_CONFIG常量
- 优化了代码的可维护性和扩展性

### 🛠️ 技术改进

#### 架构调整
- 集成了PPT2Article后端服务，用于处理文章生成逻辑
- 实现了n8n地址的统一管理，便于后续更换地址

#### 性能优化
- 优化了代码结构，提高了可维护性
- 减少了硬编码，便于配置管理

### 🐛 修复问题
- 修复了文章标题显示问题，支持从文章内容中提取标题
- 修复了微调功能，实现了refinePrompt的正确传递
- 修复了按钮状态问题，确保生成和微调成功后按钮状态能正确重置

## 总结

本次更新主要新增了文章生成功能，将ArcherDoc AI升级为集翻译、视频生成和文章生成于一体的智能PPT处理工具。更新内容包括：

1. 新增了完整的文章生成系统，包括文章生成、设置和审核功能
2. 新增了多个组件和页面，用于支持文章生成功能
3. 实现了n8n地址的统一管理，提高了代码的可维护性
4. 修复了一些已知问题，改进了用户体验

这些更新使ArcherDoc AI成为一款功能更加强大的智能PPT处理工具，能够满足用户更多的需求。