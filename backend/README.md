# ArcherDoc AI - Backend

ArcherDoc AI åç«¯æœåŠ¡ï¼Œè´Ÿè´£å¤„ç†å¤æ‚çš„æ–‡æ¡£è§£æã€AI å†…å®¹ç”Ÿæˆã€è§†é¢‘åˆæˆä¸æ–‡ä»¶è½¬æ¢ä»»åŠ¡ã€‚

## ğŸ›  æŠ€æœ¯æ ˆ

- **è¿è¡Œæ—¶**: Node.js (å»ºè®® v18+)
- **æ¡†æ¶**: Express.js
- **è¯­è¨€**: TypeScript
- **AI SDK**: Google Generative AI (Gemini), Ollama/vLLM (OpenAI Compatible)
- **æ–‡æ¡£å¤„ç†**: Mammoth (DOCX), PPTXå¤„ç†
- **å¤šåª’ä½“**: FFmpeg (è§†é¢‘åˆæˆ), Sharp (å›¾ç‰‡å¤„ç†)

## ğŸ“‚ ç›®å½•ç»“æ„

```text
backend/
â”œâ”€â”€ jobs/                # ä»»åŠ¡ä¸´æ—¶æ–‡ä»¶å­˜å‚¨ (è‡ªåŠ¨ç”Ÿæˆ)
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ middleware/      # ä¸­é—´ä»¶ (Logger, ErrorHandler)
â”‚   â”œâ”€â”€ routes/          # è·¯ç”±æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ doc.ts       # DOCX æ–‡æ¡£ç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ image.ts     # å›¾ç‰‡ç”Ÿæˆä¸å¹»ç¯ç‰‡åˆ†æ
â”‚   â”‚   â”œâ”€â”€ video.ts     # è§†é¢‘ç”Ÿæˆä¸åˆæˆ
â”‚   â”‚   â”œâ”€â”€ article.ts   # æ–‡ç« ç”Ÿæˆ
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ services/        # ä¸šåŠ¡é€»è¾‘å±‚ (AIService, VideoService...)
â”‚   â”œâ”€â”€ types/           # ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ utils/           # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ app.ts           # Express åº”ç”¨é…ç½®
â”‚   â””â”€â”€ server.ts        # æœåŠ¡å…¥å£
â””â”€â”€ package.json
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

åœ¨ `backend` ç›®å½•ä¸‹è¿è¡Œï¼š
```bash
npm install
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

åç«¯ä¾èµ– `.env` æ–‡ä»¶æ¥è·å– API Key å’Œ ç«¯å£é…ç½®ã€‚è¯·å‚è€ƒä»¥ä¸‹å†…å®¹åˆ›å»º `.env`ï¼š

```properties
PORT=4567
# AI æœåŠ¡é…ç½® (éƒ¨åˆ†å¯é€‰ï¼Œè§†å…·ä½“ä¸šåŠ¡é€»è¾‘è€Œå®š)
GEMINI_API_KEY=your_gemini_key
MINIMAX_GROUP_ID=...
MINIMAX_ACCESS_TOKEN=...
```

### 3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```
æœåŠ¡é»˜è®¤è¿è¡Œåœ¨ `http://localhost:4567`ã€‚

### 4. ç”Ÿäº§ç¯å¢ƒè¿è¡Œ

ç¼–è¯‘ TS ä»£ç ï¼š
```bash
npm run build
```
å¯åŠ¨ç¼–è¯‘åçš„ä»£ç ï¼š
```bash
npm start
```

## ğŸ”Œ API æ¦‚è§ˆ

æ‰€æœ‰ API å‡ä»¥ `/webhook/api` ä¸ºå‰ç¼€ (ä¸ºå…¼å®¹ç°æœ‰ N8N è°ƒç”¨ä¹ æƒ¯)ã€‚

| æ¨¡å— | æ–¹æ³• | è·¯å¾„ | æè¿° |
|------|------|------|------|
| **æ–‡æ¡£** | POST | `/generate-docx` | ç”Ÿæˆ Word æ–‡æ¡£ |
| **å›¾åƒ** | POST | `/analyze-slide-for-image` | åˆ†æå¹»ç¯ç‰‡ç”Ÿæˆ Prompt |
| **å›¾åƒ** | POST | `/generate-images` | è°ƒç”¨ ComfyUI/Gemini ç”Ÿæˆå›¾ç‰‡ |
| **è§†é¢‘** | POST | `/generate-video` | ç”Ÿæˆå•é¡µæˆ–å…¨é‡è§†é¢‘ |
| **æ–‡ç« ** | POST | `/generate-article` | ç”Ÿæˆæ–‡ç«  |
| **æ–‡ç« ** | POST | `/regenerate-article` | æ–‡ç« æ¶¦è‰²ä¸é‡å†™ |

## ğŸ“¦ ä¾èµ–è¯´æ˜

*   **FFmpeg**: è§†é¢‘ç”ŸæˆåŠŸèƒ½ä¾èµ–ç³»ç»Ÿå®‰è£…çš„ `ffmpeg`ã€‚è¯·ç¡®ä¿æœåŠ¡å™¨å·²å®‰è£…å¹¶åŠ å…¥äº† PATHã€‚
*   **LibreOffice** (å¯é€‰): éƒ¨åˆ†æ–‡æ¡£è½¬æ¢åŠŸèƒ½å¯èƒ½ä¾èµ–ã€‚
*   **Poppler-utils** (å¯é€‰): PDF å¤„ç†ä¾èµ–ã€‚
